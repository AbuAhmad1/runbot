<?xml version="1.0" encoding="utf-8"?>
  <odoo>
    <record id="runbot_build_config_step_dump" model="runbot.build.config.step">
        <field name="name">dump</field>
        <field name="job_type">python</field>
        <field name="python_code">
    if build.branch_id.dump:
    previous_step_index = build.config_id.step_ids().index(build.active_step) - 1
    previous_step_name = build.config_id.step_ids()[previous_step_index].name
    db_name = "%s-%s" % (build.dest, previous_step_name)
    cmd = '&emp;&emp;'.join([
        'cd /data/build',
         'mkdir -p dump',
         'pg_dump -d %(db_name)s > %(db_name)s.sql',
         'tar -c --transform "s/datadir\/filestore\/%(db_name)s/filestore/" -f dump/%(db_name)s.tar.gz %(db_name)s.sql datadir/filestore/%(db_name)s' % {'db_name': db_name}
    ])
    docker_run(cmd, log_path, build._path(), build._get_docker_name())
        </field>
        <field name="protected" eval="True"/>
        <field name="default_sequence">25</field>
    </record>

    <record id="runbot_build_config_step_save_dump" model="runbot.build.config.step">
        <field name="name">save_dump</field>
        <field name="job_type">python</field>
        <field name="python_code">build._save_dump()</field>
        <field name="protected" eval="True"/>
        <field name="default_sequence">30</field>
    </record>
  </odoo>
</xml>